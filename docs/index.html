<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Discord rss bot by freiheit</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Discord rss bot</h1>
        <h2>A Discord bot that reads RSS feeds and repeats them into a channel</h2>

        <section id="downloads">
          <a href="https://github.com/freiheit/discord_rss_bot/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/freiheit/discord_rss_bot/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/freiheit/discord_rss_bot" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="discord-rss-bot" class="anchor" href="#discord-rss-bot" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/freiheit/discord_rss_bot">Discord RSS Bot</a>
</h1>

<p><img src="avatar-angry-small.png" alt="Feed Bot"></p>

<p>Bot for taking in an RSS or Atom feed and sharing it into a Discord channel.</p>

<p>Designed to be very configurable.</p>

<p>It should be possible to use as a library in another bot.</p>

<p>Since this bot doesn't <em>react</em> to anything in channels or messages, you could always
have it sign into the same account as another bot, and externally it should appear to
be a single bot.</p>

<h2>
<a id="initial-setup" class="anchor" href="#initial-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Initial Setup</h2>

<ol>
<li>Make sure the time on your system is correct. (NTP strongly recommended)</li>
<li>Go here: <a href="https://discordapp.com/developers/applications/me#top">https://discordapp.com/developers/applications/me#top</a>
</li>
<li>Register an "application" and create an "app bot user".</li>
<li>Replace "APP_CLIENT_ID" with the App's Client ID in this URL:
<a href="https://discordapp.com/oauth2/authorize?&amp;client_id=APP_CLIENT_ID&amp;scope=bot&amp;permissions=153600">https://discordapp.com/oauth2/authorize?&amp;client_id=APP_CLIENT_ID&amp;scope=bot&amp;permissions=153600</a>
</li>
<li>Give that URL to the Discord server/guild owner and have them authorize
the bot.</li>
<li>
<code>git clone</code> this repo.</li>
<li>Copy feed2discord.ini to feed2discord.local.ini</li>
<li>Put the App Bot User's 'Token' in the .ini file.</li>
<li>Set the timezone in the .ini file to the same as the timezone your system is set to.</li>
<li>Get all the channel IDs (Turn on "Developer Mode" in Settings/Appearance, then right-click channel)</li>
<li>Figure out your feeds.

<ul>
<li>You'll need to figure out what fields by examining what's in an item in your feeds.</li>
</ul>
</li>
<li>configure feeds in feed2discord.local.ini (anything that's not MAIN, CHANNELS or DEFAULT is assumed to be a feed)</li>
<li>Run the bot.</li>
</ol>

<h2>
<a id="use-as-library" class="anchor" href="#use-as-library" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Use as Library</h2>

<p>I have not tested at all, but I have tried to make it possible to plug this
in as a library. Probably needs work. You'll need to replace your simple
"client.run()" with the more complicated stuff inside the if <strong>name</strong> block
instead (in order to insert the background task coroutines into async)</p>

<p>If you want to do live changes, you should be able to change the CONFIG variable.</p>

<p>I'm guessing a few changes will need to be made in order to run as a
library, like maybe changing how client= gets set, to something with a
setup function that takes an optional client argument, maybe? If you figure
it out, please give me a pull request.</p>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requirements</h2>

<p>(see also requirements.txt)</p>

<ul>
<li>Python 3.4.2+</li>
<li><a href="https://github.com/Rapptz/discord.py">discord.py</a></li>
<li><a href="https://pypi.python.org/pypi/feedparser">feedparser</a></li>
<li><a href="https://pypi.python.org/pypi/html2text">html2text</a></li>
</ul>

<h2>
<a id="frequently-asked-questions" class="anchor" href="#frequently-asked-questions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Frequently Asked Questions</h2>

<h3>
<a id="how-do-i-figure-out-my-timezone" class="anchor" href="#how-do-i-figure-out-my-timezone" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How do I figure out my timezone?</h3>

<p>On Windows, check settings/time for the timezone or run "tzutil /g".</p>

<p>On Unix/Linux systems, this is more complicated than it should be. Things to check:</p>

<ul>
<li><code>echo $TZ</code></li>
<li><code>ls -l /etc/localtime</code></li>
<li><code>cat /etc/timezone</code></li>
<li><code>find /usr/share/zoneinfo/ -type f| xargs md5sum | grep $(md5sum /etc/localtime  | cut -d' ' -f1)</code></li>
<li>
<code>date +%Z</code> # careful, may give you a timezone only useful half of the year</li>
</ul>

<h3>
<a id="it-looks-like-its-working-but-nothing-posts-and-logs-say-too-old-skipping-for-everything" class="anchor" href="#it-looks-like-its-working-but-nothing-posts-and-logs-say-too-old-skipping-for-everything" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>It looks like it's working, but nothing posts, and logs say <code>too old; skipping</code> for everything.</h3>

<p>Double-check your timezone settings! If the timezone isn't right, and max_age is under 24 hours (86400), then it's possible for
brand-new posts to look too old to post.</p>

<p>If it all looks right, try turning on debug in .ini. Then look for output like this:</p>

<pre><code>DEBUG:__main__:reddit:now:1467657389.0983927
DEBUG:__main__:reddit:now:gmtime:time.struct_time(tm_year=2016, tm_mon=7, tm_mday=4, tm_hour=18, tm_min=36, tm_sec=29, tm_wday=0, tm_yday=186, tm_isdst=0)
DEBUG:__main__:reddit:now:localtime:time.struct_time(tm_year=2016, tm_mon=7, tm_mday=4, tm_hour=11, tm_min=36, tm_sec=29, tm_wday=0, tm_yday=186, tm_isdst=1)
DEBUG:__main__:reddit:timezone.localize(datetime.now()):2016-07-04 11:36:29.098784-07:00
DEBUG:__main__:reddit:pubDate:Mon Jul 04 14:04:44 UTC 2016
DEBUG:__main__:reddit:pubDate_parsed:2016-07-04 14:04:44+00:00
DEBUG:__main__:reddit:pubDate_parsed.astimezome(timezone):2016-07-04 07:04:44-07:00
</code></pre>

<p>If <code>now:localtime</code> doesn't look like your current time and/or <code>now:gmtime</code> doesn't look like current UTC time, that's your problem. <code>now:gmtime</code> being off indicates your system clock is wrong. If <code>now:gmtime</code> is right, but <code>now:localtime</code> is not, you probably have the timezone set wrong in your .ini file.</p>

<p>Workarounds:</p>

<ul>
<li>set timezone to "UTC" and also run the script with the <code>TZ</code> environment variable set to <code>UTC</code>, in order to run this one program in UTC.</li>
<li>Set max_age to 86400 (24 hours) or higher. The max_age setting is mostly just there to keep the first run on a feed from spamming your channels. You can run once with output only to a test channel, then stop, reconfigure for real channels, and run again.</li>
</ul>
      </section>
    </div>

    
  </body>
</html>
